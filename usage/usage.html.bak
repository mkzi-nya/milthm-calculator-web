<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Usage</title>
  <!-- æ›¿æ¢åŸå…ˆçš„ load.js åŠ è½½æ–¹å¼ -->
<script>
  const rand = `rand=${Date.now()}`;
  const script = document.createElement('script');
  script.src = `./load.js?${rand}`;
  document.head.appendChild(script);
</script>
  <link rel="stylesheet" href="./github-markdown-dark.min.css">
  <script src="./marked.min.js"></script>
  <script src="./katex.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
  <script src="./index.umd.js"></script>
  <link rel="stylesheet" href="./github-dark.min.css">
  <script src="./highlight.min.js"></script>

  <style>
    body {
      margin: 0;
      padding: 20px;
      box-sizing: border-box;
      background: #0d1117;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }

    .container {
      width: 100%;
      max-width: 900px;
    }

    .markdown-body {
      width: 100%;
      overflow-wrap: break-word;
    }

    .katex-display {
      display: block !important;
      text-align: center;
      margin: 10px 0;
      font-size: 1em;
    }

    .toc {
      display: none;
    }

    pre,
    code {
      user-select: text;
    }

    .language-selector {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #222;
      padding: 5px;
      /* èª¿å°å…§é‚Šè· */
      border-radius: 5px;
      cursor: pointer;
      color: white;
      font-size: 2em;
      /* å¯é¸ï¼šç¸®å°å­—é«” */
    }

    .language-menu {
      display: none;
      position: absolute;
      top: 40px;
      right: 10px;
      background: #222;
      border-radius: 5px;
      padding: 10px;
      list-style: none;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    }

    .language-menu li {
      padding: 8px 12px;
      cursor: pointer;
      color: white;
    }

    .language-menu li:hover {
      background: #444;
    }

    /* éšè—aaaæ ‡ç­¾çš„å¼¹çª—å¹¶å…è®¸ç‚¹å‡» */
    div[aaa] {
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.2s ease-in-out, visibility 0.3s ease-in-out;

    }

    /* æ˜¾ç¤ºæ—¶çš„æ ·å¼ */
    div[aaa].visible {
      visibility: visible;
      opacity: 1;
    }
  </style>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-L5K3QVRHFZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-L5K3QVRHFZ');
  </script>
</head>

<body>
  <!-- è¯­è¨€é€‰æ‹©æŒ‰é’® -->
  <div class="language-selector" onclick="toggleLanguageMenu()">ğŸŒ</div>
  <ul class="language-menu" id="language-menu">
    <li onclick="changeLanguage('zh')">ä¸­æ–‡</li>
    <li onclick="changeLanguage('zh-tw')">ç¹é«”ä¸­æ–‡</li>
    <li onclick="changeLanguage('en')">English</li>
    <li onclick="changeLanguage('ja')">æ—¥æœ¬èª</li>
    <li onclick="changeLanguage('ko')">í•œêµ­ì–´</li>
    <li onclick="changeLanguage('ru')">Ğ ÑƒÑÑĞºĞ¸Ğ¹</li>
    <li onclick="changeLanguage('es')">EspaÃ±ol</li>
    <li onclick="changeLanguage('vi')">Tiáº¿ng Viá»‡t</li>
    <li onclick="changeLanguage('ken')">â‹¿ã‚¦áµã†‘ã‚¨ã„ã‚µ</li>
  </ul>
  <div class="container">
    <article id="content" class="markdown-body"></article>
  </div>
  <script>
    marked.use(markedKatex());
    marked.setOptions({
      highlight: (code, lang) => {
        if (lang && hljs.getLanguage(lang)) return hljs.highlight(code, { language: lang }).value;
        return hljs.highlightAuto(code).value;
      }
    });
    function getUserLanguage() {
      const langMap = {
        "zh": "zh",
        "zh-cn": "zh",
        "zh-tw": "zh-tw",
        "en": "en",
        "ja": "ja",
        "ko": "ko",
        "ru": "ru",
        "es": "es",
        "vi": "vi"
      };
      // è¯»å–URLå‚æ•°ä¸­çš„ `lang`ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
      const urlParams = new URLSearchParams(window.location.search);
      let lang = urlParams.get('lang') || navigator.language.toLowerCase();
      return langMap[lang] || "en"; // é»˜è®¤è‹±æ–‡
    }
    function loadMarkdown() {
      const lang = getUserLanguage();
      fetch(`./usage_${lang}.md?${Date.now()}`)
        .then(res => res.text())
        .then(md => {
          // åœ¨è¿™é‡Œè¿›è¡Œé“¾æ¥çš„è‡ªåŠ¨è½¬ä¹‰å¤„ç†
          md = md.replace(/\[([^\]]+)\]\(([^)]+)\)/g, function (match, p1, p2) {
            // åªå¤„ç†åŒ…å« 'info:' çš„é“¾æ¥
            if (p2.startsWith('info:')) {
              const [protocol, rest] = p2.split(':', 2);  // åˆ†ç¦»åè®®å’Œå‰©ä½™éƒ¨åˆ†
              const encodedRest = encodeURIComponent(rest);  // å¯¹å‰©ä½™éƒ¨åˆ†è¿›è¡Œç¼–ç 
              return `[${p1}](${protocol}:${encodedRest})`;  // ä¿æŒ 'info:' åè®®ä¸å˜
            }
            const encodedUrl = p2;
            return `[${p1}](${encodedUrl})`;
          });
          content.innerHTML = marked.parse(md, { headerIds: true, mangle: false });
          content.querySelectorAll('h2,h3,h4').forEach(h => {
            h.id = h.innerText.toLowerCase().replace(/\s+/g, '-');
          });
          hljs.highlightAll();
          resizeKatex();
          runJavascriptLinks();
          loaddiv()
        })
        .catch(() => {
          content.innerHTML = `<p style="color: red;">æœªæ‰¾åˆ° <b>usage_${lang}.md</b> æ–‡ä»¶</p>`;
        });
    }

    function runJavascriptLinks() {
      const links = document.querySelectorAll('a[href^="info:info"], a[href^="info:info"]');
      links.forEach(link => {
        link.addEventListener('click', function (event) {
          event.preventDefault(); // é˜»æ­¢é»˜è®¤çš„é“¾æ¥è·³è½¬
        });
      });
    }

    function resizeKatex() {
      const w = document.querySelector('.markdown-body').clientWidth;
      document.querySelectorAll('.katex-display').forEach(e => {
        e.style.fontSize = ''; // å…ˆè¿˜åŸé»˜è®¤å¤§å°
        const actual = e.scrollWidth;
        if (actual > w) {
          const fs = parseFloat(getComputedStyle(e).fontSize);
          e.style.fontSize = (fs * w / actual) + 'px';
        }
      });
    }

    function toggleLanguageMenu() {
      const menu = document.getElementById("language-menu");
      menu.style.display = (menu.style.display === "block") ? "none" : "block";
    }
    function changeLanguage(lang) {
      // åˆ·æ–°é¡µé¢å¹¶åŠ ä¸Š `?lang=xx` å‚æ•°
      window.location.search = `?lang=${lang}`;
    }
    // åˆå§‹åŒ–
    window.addEventListener('resize', resizeKatex);
    window.addEventListener('load', loadMarkdown);
    function checkMouseOnLink(event) {
      const target = event.target;

      // ç¡®ä¿é¼ æ ‡åœç•™åœ¨ä¸€ä¸ªé“¾æ¥ä¸Š
      if (target.tagName === 'A') {
        const url = decodeURIComponent(target.href); // è§£ç é“¾æ¥URL

        const regex = /(info)\(([^)]*)\)/;
        const match = url.match(regex);

        if (match) {
          const funcName = match[1];
          const params = match[2].split(',').map(param => param.trim().replace(/['"]/g, ''));  // è·å–å‡½æ•°å‚æ•°å¹¶å»é™¤å¼•å·

          // è·å–é“¾æ¥çš„ä½ç½®ä¿¡æ¯
          const linkRect = target.getBoundingClientRect();

          // é¼ æ ‡åœç•™åœ¨é“¾æ¥æ—¶å¤„ç†æ˜¾ç¤º
          if (params.length === 2) {
            // å¦‚æœæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œå°†aaaè®¾ç½®ä¸ºæ˜¾ç¤ºçŠ¶æ€ï¼Œå¹¶æ˜¾ç¤ºä¸º "a,b"
            const [param1, param2] = params;
            const aaaElement = document.querySelector(`div[aaa="${param1},${param2}"]`);
            if (aaaElement) {
              aaaElement.classList.add('visible');

              // è®¡ç®—divçš„ä½ç½®ï¼Œæ”¾ç½®åœ¨é“¾æ¥çš„æ­£ä¸‹æ–¹ï¼Œå¹¶ç¡®ä¿divçš„ä¸­å¿ƒä¸é“¾æ¥çš„ä¸­å¿ƒå¯¹é½
              const topPosition = linkRect.bottom + window.scrollY; // è®¡ç®—é¡¶éƒ¨ä½ç½®
              let leftPosition = linkRect.left + linkRect.width / 2 + window.scrollX - aaaElement.offsetWidth / 2; // è®¡ç®—å·¦è¾¹ä½ç½®ï¼Œå±…ä¸­æ˜¾ç¤º

              // ç¡®ä¿divä¸è¶…å‡ºå±å¹•å·¦è¾¹æˆ–å³è¾¹
              const screenWidth = window.innerWidth;
              const elementWidth = aaaElement.offsetWidth;
              if (leftPosition + elementWidth > screenWidth) {
                leftPosition = screenWidth - elementWidth; // è¶…å‡ºå³è¾¹ç•Œæ—¶è°ƒæ•´
              } else if (leftPosition < 0) {
                leftPosition = 0; // è¶…å‡ºå·¦è¾¹ç•Œæ—¶è°ƒæ•´
              }

              // è®¾ç½®divçš„ä½ç½®
              aaaElement.style.position = 'absolute';
              aaaElement.style.top = `${topPosition}px`;
              aaaElement.style.left = `${leftPosition}px`;

            }
          }
          // æ£€æŸ¥æ˜¯å¦åªæœ‰ä¸€ä¸ªå‚æ•°
          else if (params.length === 1 && params[0]) {
            // å¦‚æœæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå°†aaaè®¾ç½®ä¸ºæ˜¾ç¤ºçŠ¶æ€ï¼Œå¹¶æ˜¾ç¤ºä¸º "a"
            const [param] = params;
            const aaaElement = document.querySelector(`div[aaa="${param}"]`);
            if (aaaElement) {
              aaaElement.classList.add('visible');

              // è®¡ç®—divçš„ä½ç½®ï¼Œæ”¾ç½®åœ¨é“¾æ¥çš„æ­£ä¸‹æ–¹ï¼Œå¹¶ç¡®ä¿divçš„ä¸­å¿ƒä¸é“¾æ¥çš„ä¸­å¿ƒå¯¹é½
              const topPosition = linkRect.bottom + window.scrollY; // è®¡ç®—é¡¶éƒ¨ä½ç½®
              let leftPosition = linkRect.left + linkRect.width / 2 + window.scrollX - aaaElement.offsetWidth / 2; // è®¡ç®—å·¦è¾¹ä½ç½®ï¼Œå±…ä¸­æ˜¾ç¤º

              // ç¡®ä¿divä¸è¶…å‡ºå±å¹•å·¦è¾¹æˆ–å³è¾¹
              const screenWidth = window.innerWidth;
              const elementWidth = aaaElement.offsetWidth;
              if (leftPosition + elementWidth > screenWidth) {
                leftPosition = screenWidth - elementWidth; // è¶…å‡ºå³è¾¹ç•Œæ—¶è°ƒæ•´
              } else if (leftPosition < 0) {
                leftPosition = 0; // è¶…å‡ºå·¦è¾¹ç•Œæ—¶è°ƒæ•´
              }

              // è®¾ç½®divçš„ä½ç½®
              aaaElement.style.position = 'absolute';
              aaaElement.style.top = `${topPosition}px`;
              aaaElement.style.left = `${leftPosition}px`;

            }
          }

          // é¼ æ ‡ç§»å¼€æ—¶å°† aaa å…ƒç´ éšè—
          target.addEventListener('mouseleave', () => {
            if (params.length === 2) {
              const aaaElement = document.querySelector(`div[aaa="${params.join(',')}"]`);
              if (aaaElement) {
                aaaElement.classList.remove('visible');
              }
            } else if (params.length === 1 && params[0]) {
              const aaaElement = document.querySelector(`div[aaa="${params[0]}"]`);
              if (aaaElement) {
                aaaElement.classList.remove('visible');
              }
            }
          });
        }
      }
    }


    // åœ¨æ–‡æ¡£ä¸Šç›‘å¬é¼ æ ‡ç§»åŠ¨äº‹ä»¶
    document.addEventListener('mousemove', checkMouseOnLink);

  </script>
</body>

</html>