<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Usage</title>
  <script src="./load.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css/github-markdown-dark.min.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script src="https://cdn.jsdelivr.net/npm/marked-katex-extension/lib/index.umd.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
  <style>
    body {
      margin: 0; padding: 20px; box-sizing: border-box; background: #0d1117;
      display: flex; flex-direction: column; align-items: center; position: relative;
    }
    .container { width: 100%; max-width: 900px; }
    .markdown-body { width: 100%; overflow-wrap: break-word; }
    .katex-display { display: block !important; text-align: center; margin: 10px 0; font-size: 1em; }
    .toc { display: none; }
    pre, code { user-select: text; }

.language-selector {
  position: absolute;
  top: 10px;
  right: 10px;
  background: #222;
  padding: 5px; /* èª¿å°å…§é‚Šè· */
  border-radius: 5px;
  cursor: pointer;
  color: white;
  font-size: 2em; /* å¯é¸ï¼šç¸®å°å­—é«” */
}
    .language-menu {
      display: none; position: absolute; top: 40px; right: 10px; background: #222;
      border-radius: 5px; padding: 10px; list-style: none; box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    }
    .language-menu li {
      padding: 8px 12px; cursor: pointer; color: white;
    }
    .language-menu li:hover {
      background: #444;
    }
  </style>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-L5K3QVRHFZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L5K3QVRHFZ');
</script>
</head>
<body>

  <!-- è¯­è¨€é€‰æ‹©æŒ‰é’® -->
  <div class="language-selector" onclick="toggleLanguageMenu()">ğŸŒ</div>
  <ul class="language-menu" id="language-menu">
    <li onclick="changeLanguage('zh')">ä¸­æ–‡</li>
    <li onclick="changeLanguage('zh-tw')">ç¹é«”ä¸­æ–‡</li>
    <li onclick="changeLanguage('en')">English</li>
    <li onclick="changeLanguage('ja')">æ—¥æœ¬èª</li>
    <li onclick="changeLanguage('ko')">í•œêµ­ì–´</li>
    <li onclick="changeLanguage('ru')">Ğ ÑƒÑÑĞºĞ¸Ğ¹</li>
    <li onclick="changeLanguage('es')">EspaÃ±ol</li>
    <li onclick="changeLanguage('vi')">Tiáº¿ng Viá»‡t</li>
  </ul>

  <div class="container">
    <article id="content" class="markdown-body"></article>
  </div>

  <script>
    marked.use(markedKatex());
    marked.setOptions({
      highlight: (code, lang) => {
        if (lang && hljs.getLanguage(lang)) return hljs.highlight(code, {language: lang}).value;
        return hljs.highlightAuto(code).value;
      }
    });

    function getUserLanguage() {
      const langMap = {
        "zh": "zh",
        "zh-cn": "zh",
        "zh-tw": "zh-tw",
        "en": "en",
        "ja": "ja",
        "ko": "ko",
        "ru": "ru",
        "es": "es",
        "vi": "vi"
      };

      // è¯»å–URLå‚æ•°ä¸­çš„ `lang`ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
      const urlParams = new URLSearchParams(window.location.search);
      let lang = urlParams.get('lang') || navigator.language.toLowerCase();
      
      return langMap[lang] || "en"; // é»˜è®¤è‹±æ–‡
    }

    function loadMarkdown() {
      const lang = getUserLanguage();
      fetch(`./usage_${lang}.md`)
        .then(res => res.text())
        .then(md => {
          // åœ¨è¿™é‡Œè¿›è¡Œé“¾æ¥çš„è‡ªåŠ¨è½¬ä¹‰å¤„ç†
md = md.replace(/\[([^\]]+)\]\(([^)]+)\)/g, function(match, p1, p2) {

if (p2.startsWith('#')) {
    return `[${p1}](${p2})`;
}

// åªå¤„ç†åŒ…å« 'javascript:' çš„é“¾æ¥
if (p2.startsWith('javascript:')) {
    const [protocol, rest] = p2.split(':', 2);  // åˆ†ç¦»åè®®å’Œå‰©ä½™éƒ¨åˆ†
    const encodedRest = encodeURIComponent(rest);  // å¯¹å‰©ä½™éƒ¨åˆ†è¿›è¡Œç¼–ç 
    return `[${p1}](${protocol}:${encodedRest})`;  // ä¿æŒ 'javascript:' åè®®ä¸å˜
}

  const encodedUrl = p2;
  return `[${p1}](${encodedUrl})`;
});



          content.innerHTML = marked.parse(md, { headerIds: true, mangle: false });
          content.querySelectorAll('h2,h3,h4').forEach(h=>{
            h.id = h.innerText.toLowerCase().replace(/\s+/g,'-');
          });
          hljs.highlightAll();
          resizeKatex();
        })
        .catch(() => {
          content.innerHTML = `<p style="color: red;">æœªæ‰¾åˆ° <b>usage_${lang}.md</b> æ–‡ä»¶</p>`;
        });
    }

    function resizeKatex() {
      const w = document.querySelector('.markdown-body').clientWidth;
      document.querySelectorAll('.katex-display').forEach(e=>{
        e.style.fontSize = ''; // å…ˆè¿˜åŸé»˜è®¤å¤§å°
        const actual = e.scrollWidth;
        if(actual > w){
          const fs = parseFloat(getComputedStyle(e).fontSize);
          e.style.fontSize = (fs * w / actual) + 'px';
        }
      });
    }

    function toggleLanguageMenu() {
      const menu = document.getElementById("language-menu");
      menu.style.display = (menu.style.display === "block") ? "none" : "block";
    }

    function changeLanguage(lang) {
      // åˆ·æ–°é¡µé¢å¹¶åŠ ä¸Š `?lang=xx` å‚æ•°
      window.location.search = `?lang=${lang}`;
    }

    // åˆå§‹åŒ–
    window.addEventListener('resize', resizeKatex);
    window.addEventListener('load', loadMarkdown);
  </script>

</body>
</html>
